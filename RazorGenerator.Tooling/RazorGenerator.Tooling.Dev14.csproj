<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <MinimumVisualStudioVersion>16.0</MinimumVisualStudioVersion>
    <VSToolsPath Condition="'$(VSToolsPath)' == ''">$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)</VSToolsPath>
  </PropertyGroup>
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
    <!-- Stock VSIX .csproj properties: -->
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <SchemaVersion>2.0</SchemaVersion>
    <ProjectTypeGuids>{82b43b9b-a64c-4715-b499-d71e9ca2bd60};{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}</ProjectTypeGuids>
    <ProjectGuid>{029A884E-D234-4D66-9C28-0ABED066725E}</ProjectGuid>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>RazorGenerator</RootNamespace>
    <AssemblyName>RazorGenerator</AssemblyName>
    <TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>
    <VsixType>v3</VsixType>
    <GeneratePkgDefFile>true</GeneratePkgDefFile>
    <UseCodebase>true</UseCodebase>
    <IncludeAssemblyInVSIXContainer>true</IncludeAssemblyInVSIXContainer>
    <IncludeDebugSymbolsInVSIXContainer>true</IncludeDebugSymbolsInVSIXContainer>
    <IncludeDebugSymbolsInLocalVSIXDeployment>true</IncludeDebugSymbolsInLocalVSIXDeployment>
    <CopyBuildOutputToOutputDirectory>true</CopyBuildOutputToOutputDirectory>
    <CopyOutputSymbolsToOutputDirectory>true</CopyOutputSymbolsToOutputDirectory>
    <DebugSymbols>true</DebugSymbols>
    <StartAction>Program</StartAction>
    <StartProgram Condition="'$(DevEnvDir)' != ''">$(DevEnvDir)devenv.exe</StartProgram>
    <StartArguments>/rootsuffix Exp</StartArguments>
    <!--
    To specify a different registry root to register your package, uncomment the TargetRegistryRoot
    tag and specify a registry root in it.
    <TargetRegistryRoot></TargetRegistryRoot>
    -->
    <RegisterOutputPackage>true</RegisterOutputPackage>
    <RegisterWithCodebase>true</RegisterWithCodebase>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>bin\Debug\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <OutputPath>bin\Release\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <ItemGroup>
    <!-- References: -->
    <ProjectReference Include="..\RazorGenerator.Core\RazorGenerator.Core.csproj">
      <Project>{af040852-112f-494d-b1d0-b50888928db6}</Project>
      <Name>RazorGenerator.Core</Name>
    </ProjectReference>
    <PackageReference Include="Microsoft.VisualStudio.SDK" Version="16.0.206" ExcludeAssets="runtime" />
    <PackageReference Include="Microsoft.VSSDK.BuildTools" Version="16.8.3038" />
    <Reference Include="System" />
    <!-- RazorGenerator.Tooling.csproj files: -->
    <Compile Include="BaseCodeGenerator.cs"/>
    <Compile Include="BaseCodeGeneratorWithSite.cs"/>
    <Compile Include="Extensions.cs"/>
    <Compile Include="RazorGenerator.cs"/>
    <EmbeddedResource Include="Resources\SingleFileResources.resx" ManifestResourceName="RazorGenerator.Resources.SingleFileResources">
      <Generator>ResXFileCodeGenerator</Generator>
      <SubType>Designer</SubType>
      <LastGenOutput>SingleFileResources.Designer.cs</LastGenOutput>
      <CustomToolNamespace>RazorGenerator.Resources</CustomToolNamespace>
    </EmbeddedResource>
    <Compile Include="RazorGeneratorToolingException.cs"/>
    <Compile Include="Resources\SingleFileResources.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>SingleFileResources.resx</DependentUpon>
    </Compile>
    <!-- RazorGenerator.Tooling.VS2019-specific files: -->
    <None Include="source.extension.vsixmanifest">
      <SubType>Designer</SubType>
    </None>
    <Compile Include="VsGeneratorProgressExtensions.cs">
      <Link>Linked\VsGeneratorProgressExtensions.cs</Link>
    </Compile>
    <Compile Include="Properties\AssemblyInfo.cs" />
  </ItemGroup>
  <ItemGroup>
    <Content Include="ReadMe.txt"/>
    <Content Include="LICENSE.txt" />
  </ItemGroup>
  <Import Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" />
  <Import Condition="Exists($(VsSdkTargets))" Project="$(VsSdkTargets)" />
  <!-- I think this (`<Import Condition="Exists($(VsSdkTargets))" Project="$(VsSdkTargets)" />`) can be removed -->
  <PropertyGroup>
    <CreateVsixContainerDependsOn>$(CreateVsixContainerDependsOn);_CreateSourceItems</CreateVsixContainerDependsOn>
  </PropertyGroup>
  <!-- RazorGenerator VSIX Targets: -->
  <Target Name="_CreateSourceItems">
    <!-- Copy the Core.v1 and v2 binaries inside the v1 and v2 directories of the vsix. This is to resolve bug 72 -->
    <ItemGroup>
      <VSIXSourceItem Include="LICENSE.txt" />
      <VSIXSourceItem Include="..\RazorGenerator.Core.v1\bin\$(Configuration)\*.dll" Exclude="..\RazorGenerator.Core.v1\bin\$(Configuration)\RazorGenerator.Core.dll">
        <VSIXSubPath>v1</VSIXSubPath>
      </VSIXSourceItem>
      <VSIXSourceItem Include="..\RazorGenerator.Core.v2\bin\$(Configuration)\*.dll" Exclude="..\RazorGenerator.Core.v2\bin\$(Configuration)\RazorGenerator.Core.dll">
        <VSIXSubPath>v2</VSIXSubPath>
      </VSIXSourceItem>
      <VSIXSourceItem Include="..\RazorGenerator.Core.v3\bin\$(Configuration)\*.dll" Exclude="..\RazorGenerator.Core.v3\bin\$(Configuration)\RazorGenerator.Core.dll">
        <VSIXSubPath>v3</VSIXSubPath>
      </VSIXSourceItem>
    </ItemGroup>
  </Target>
  <Target Name="InstallPlugin" DependsOnTargets="Build">
    <MakeDir Directories="$(DevEnvDir)\Extensions\$(AssemblyName)" />
    <Copy SkipUnchangedFiles="true" ContinueOnError="true" SourceFiles="$(OutputPath)source.extension.vsixmanifest" DestinationFiles="$(DevEnvDir)\Extensions\$(AssemblyName)\extension.vsixmanifest" />
  </Target>
  <Target Name="AfterBuild">
    <ItemGroup>
      <FilesToCopy Include="$(OutputPath)\*.vsix" />
    </ItemGroup>
    <PropertyGroup>
      <VsixOut>$(MsBuildProjectDirectory)\..\artifacts</VsixOut>
    </PropertyGroup>
    <MakeDir Directories="$(VsixOut)" Condition=" !Exists('$(VsixOut)') " />
    <Copy SourceFiles="@(FilesToCopy)" DestinationFolder="$(VsixOut)" />
  </Target>
  <Import Project="$(VSToolsPath)\VSSDK\Microsoft.VsSDK.targets" Condition="'$(VSToolsPath)' != ''" />
</Project>
